<%- include('../includes/main.ejs') %>
<link rel="stylesheet" href="/css/table.css">
<style>
    .itemsPerPageForm {
        margin-top: 1rem;
        margin-right: 2rem;
    }
    .pagination {
        margin-top: 1rem;
    }
</style>
<%- include('../includes/navigation.ejs') %>

<!-- Items per Page Form -->
<div class="itemsPerPageForm">
    <form id="userItemsPerPageForm" method="GET" class="items-per-page-form">
        <div class="form-input">
          <label for="userLimit">Items per page:</label>
          <select name="userLimit" id="userLimit">
            <option value="3" <%= userLimit == 3 ? "selected" : "" %>>3</option>
            <option value="5" <%= userLimit == 5 ? "selected" : "" %>>5</option>
            <option value="10" <%= userLimit == 10 ? "selected" : "" %>>10</option>
          </select>
        </div>
        <input type="hidden" name="jobSeekerPage" id="jobSeekerPage" value="<%= jobSeekerPage %>">
        <input type="hidden" name="recruiterPage" id="recruiterPage" value="<%= recruiterPage %>">
    </form>      
</div>

<div class="container">
    <%- include('../includes/flash.ejs') %>

    <!-- Job Seekers Table -->
    <h2 class="section-title">Job Seekers</h2>
    <table class="custom-table">
        <thead>
            <tr>
                <th>Sr. No.</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <% let jobSeekerCount = (jobSeekerPage - 1) * userLimit + 1; %>
            <% jobSeekers.forEach(user => { %>
                <tr>
                    <td><%= jobSeekerCount++ %></td>
                    <td><%= user.firstName %> <%= user.lastName %></td>
                    <td><%= user.email %></td>
                    <td><%= user.phone %></td>
                    <td><%= user.isActive ? 'Active' : 'Inactive' %></td>
                    <td>
                        <div class="actions">
                            <% if(user.isActive){ %>
                                <form action="/admin/deactivate" method="POST">
                                    <input type="hidden" name="userId" value="<%= user._id %>">
                                    <button type="submit" class="deactive-btn btn">Deactivate</button>
                                </form>
                            <% } else{ %>
                                <form action="/admin/activate" method="POST">
                                    <input type="hidden" name="userId" value="<%= user._id %>">
                                    <button type="submit" class="deactive-btn btn">Activate</button>
                                </form>
                            <% } %>
                            <form action="/admin/delete" method="POST">
                                <input type="hidden" name="userId" value="<%= user._id %>">
                                <button type="submit" class="delete-btn btn">Delete</button>
                            </form>
                        </div>
                    </td>
                </tr>
            <% }); %>
        </tbody>
    </table>

    <!-- Pagination for Job Seekers -->
    <% if (totalJobSeekerPages > 1) { %>
        <div class="pagination" id="jobSeekerPagination">
            <ul class="pagination-list">
                <% if (jobSeekerPage > 1) { %>
                    <a href="?jobSeekerPage=<%= jobSeekerPage - 1 %>&recruiterPage=<%= recruiterPage %>&userLimit=<%= userLimit %>#jobSeekerPagination"><li>Prev</li></a>
                <% } %>
                <span> Page <%= jobSeekerPage %> of <%= totalJobSeekerPages %> </span>
                <% if (jobSeekerPage < totalJobSeekerPages) { %>
                    <a href="?jobSeekerPage=<%= jobSeekerPage + 1 %>&recruiterPage=<%= recruiterPage %>&userLimit=<%= userLimit %>#jobSeekerPagination"><li>Next</li></a>
                <% } %>
            </ul>
        </div>
    <% } %>  

    <!-- Recruiters Table -->
    <h2 class="section-title">Recruiters</h2>
    <table class="custom-table">
        <thead>
            <tr>
                <th>Sr. No.</th>
                <th>Name</th>
                <th>Email</th>
                <th>Company</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <% let recruiterCount = (recruiterPage - 1) * userLimit + 1; %>
            <% recruiters.forEach(user => { %>
                <tr>
                    <td><%= recruiterCount++ %></td>
                    <td><%= user.firstName %> <%= user.lastName %></td>
                    <td><%= user.email %></td>
                    <td><%= user.company || "N/A" %></td>
                    <td><%= user.isActive ? 'Active' : 'Inactive' %></td>
                    <td>
                        <div class="actions">
                            <% if(user.isActive){ %>
                                <form action="/admin/deactivate" method="POST">
                                    <input type="hidden" name="userId" value="<%= user._id %>">
                                    <button type="submit" class="deactive-btn btn">Deactivate</button>
                                </form>
                            <% } else{ %>
                                <form action="/admin/activate" method="POST">
                                    <input type="hidden" name="userId" value="<%= user._id %>">
                                    <button type="submit" class="deactive-btn btn">Activate</button>
                                </form>
                            <% } %>
                            <form action="/admin/delete" method="POST">
                                <input type="hidden" name="userId" value="<%= user._id %>">
                                <button type="submit" class="delete-btn btn">Delete</button>
                            </form>
                        </div>
                    </td>
                </tr>
            <% }); %>
        </tbody>
    </table>

    <!-- Pagination for Recruiters -->
    <% if (totalRecruiterPages > 1) { %>
        <div class="pagination" id="recruiterPagination">
            <ul class="pagination-list">
                <% if (recruiterPage > 1) { %>
                    <a href="?recruiterPage=<%= recruiterPage - 1 %>&jobSeekerPage=<%= jobSeekerPage %>&userLimit=<%= userLimit %>#recruiterPagination"><li>Prev</li></a>
                <% } %>
                <span> Page <%= recruiterPage %> of <%= totalRecruiterPages %> </span>
                <% if (recruiterPage < totalRecruiterPages) { %>
                    <a href="?recruiterPage=<%= recruiterPage + 1 %>&jobSeekerPage=<%= jobSeekerPage %>&userLimit=<%= userLimit %>#recruiterPagination"><li>Next</li></a>
                <% } %>
            </ul>
        </div>
    <% } %>  
</div>

<%- include('../includes/flashScript.ejs') %>
<script src="/js/preventBack.js"></script>

<script>
    document.getElementById("userLimit").addEventListener("change", function () {
        document.getElementById("jobSeekerPage").value = 1;
        document.getElementById("recruiterPage").value = 1;
        document.getElementById("userItemsPerPageForm").submit();
    });
</script>
</body>
</html>
